import { NextRequest, NextResponse } from 'next/server';
import { PrismaClient } from '@prisma/client';
import bcrypt from 'bcryptjs';

const prisma = new PrismaClient();

/**
 * API endpoint to seed the database
 * WARNING: This should be protected in production!
 * 
 * Usage: 
 * - GET /api/admin/seed?token=YOUR_SECRET_TOKEN (for browser)
 * - POST /api/admin/seed?token=YOUR_SECRET_TOKEN (for API calls)
 */
async function seedDatabase() {
  console.log('üå± Starting database seed...');

    // –û—á–∏—Å—Ç–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
    await prisma.attempt.deleteMany();
    await prisma.question.deleteMany();
    await prisma.quiz.deleteMany();
    await prisma.lesson.deleteMany();
    await prisma.course.deleteMany();
    await prisma.user.deleteMany();

    // –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    const studentPasswordHash = await bcrypt.hash('user', 10);
    const hrPasswordHash = await bcrypt.hash('hr', 10);

    const student = await prisma.user.create({
      data: {
        username: 'user',
        passwordHash: studentPasswordHash,
        role: 'STUDENT',
        fullName: 'Demo Student',
        status: 'NEW',
        offerStatus: 'NONE',
      },
    });

    const hr = await prisma.user.create({
      data: {
        username: 'hr',
        passwordHash: hrPasswordHash,
        role: 'HR',
        fullName: 'Demo HR',
        status: 'NEW',
        offerStatus: 'NONE',
      },
    });

    // –°–æ–∑–¥–∞–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫—É—Ä—Å–∞ (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –¥–ª—è API)
    const course = await prisma.course.create({
      data: {
        title: '–û—Å–Ω–æ–≤—ã —Ä–∞–±–æ—Ç—ã —Ä–∏—ç–ª—Ç–æ—Ä–∞ –≤ –∞–≥–µ–Ω—Ç—Å—Ç–≤–µ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏',
        description: '–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∫—É—Ä—Å –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö —Ä–∏—ç–ª—Ç–æ—Ä–æ–≤, –æ—Ö–≤–∞—Ç—ã–≤–∞—é—â–∏–π –æ—Å–Ω–æ–≤—ã —Ä–∞–±–æ—Ç—ã –≤ –∞–≥–µ–Ω—Ç—Å—Ç–≤–µ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏, —ç—Ç–∏–∫—É, –≤–æ—Ä–æ–Ω–∫—É –ø—Ä–æ–¥–∞–∂, —Ä–∞–±–æ—Ç—É —Å –æ–±—ä–µ–∫—Ç–∞–º–∏ –∏ –∫–ª–∏–µ–Ω—Ç–∞–º–∏, –∞ —Ç–∞–∫–∂–µ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—É –∏ –æ—Ç—á—ë—Ç–Ω–æ—Å—Ç—å.',
        isActive: true,
        createdByUserId: hr.id,
        lessons: {
          create: [
            {
              title: '–†–æ–ª—å —Ä–∏—ç–ª—Ç–æ—Ä–∞ –≤ –∞–≥–µ–Ω—Ç—Å—Ç–≤–µ –∏ –±–∞–∑–æ–≤–∞—è —ç—Ç–∏–∫–∞',
              content: `–†–∏—ç–ª—Ç–æ—Ä –≤ –∞–≥–µ–Ω—Ç—Å—Ç–≤–µ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ –∏–≥—Ä–∞–µ—Ç –∫–ª—é—á–µ–≤—É—é —Ä–æ–ª—å –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –∫—É–ø–ª–∏-–ø—Ä–æ–¥–∞–∂–∏ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏. –û—Å–Ω–æ–≤–Ω—ã–µ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏ –≤–∫–ª—é—á–∞—é—Ç:

1. –ü–æ–∏—Å–∫ –∏ –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤ (–ø—Ä–æ–¥–∞–≤—Ü–æ–≤ –∏ –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π)
2. –ö–æ–Ω—Å—É–ª—å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –≤–æ–ø—Ä–æ—Å–∞–º –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏
3. –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ –æ–±—ä–µ–∫—Ç–æ–≤
4. –í–µ–¥–µ–Ω–∏–µ –ø–µ—Ä–µ–≥–æ–≤–æ—Ä–æ–≤ –º–µ–∂–¥—É —Å—Ç–æ—Ä–æ–Ω–∞–º–∏
5. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è —Å–¥–µ–ª–æ–∫
6. –°–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ —Å–¥–µ–ª–∫–∏ –¥–æ –µ—ë –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

–ë–∞–∑–æ–≤–∞—è —ç—Ç–∏–∫–∞ —Ä–∏—ç–ª—Ç–æ—Ä–∞:
- –ß–µ—Å—Ç–Ω–æ—Å—Ç—å –∏ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –≤ —Ä–∞–±–æ—Ç–µ —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏
- –°–æ–±–ª—é–¥–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
- –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ –æ—Ç–Ω–æ—à–µ–Ω–∏–µ –∫ –∫–æ–ª–ª–µ–≥–∞–º
- –°–æ–±–ª—é–¥–µ–Ω–∏–µ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–≤ –∞–≥–µ–Ω—Ç—Å—Ç–≤–∞
- –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∑–∞ —Å–≤–æ–∏ –¥–µ–π—Å—Ç–≤–∏—è –∏ –æ–±–µ—â–∞–Ω–∏—è`,
              order: 1,
            },
            {
              title: '–í–æ—Ä–æ–Ω–∫–∞ —Ä–∞–±–æ—Ç—ã —Å –∫–ª–∏–µ–Ω—Ç–æ–º: –æ—Ç –ª–∏–¥–∞ –¥–æ —Å–¥–µ–ª–∫–∏',
              content: `–í–æ—Ä–æ–Ω–∫–∞ –ø—Ä–æ–¥–∞–∂ –≤ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —ç—Ç–∞–ø–æ–≤:

1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ª–∏–¥–æ–≤ (Lead Generation)
2. –ö–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—è –ª–∏–¥–∞ (Lead Qualification)
3. –ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è –æ–±—ä–µ–∫—Ç–æ–≤ (Presentation)
4. –ü–µ—Ä–µ–≥–æ–≤–æ—Ä—ã (Negotiation)
5. –ó–∞–∫—Ä—ã—Ç–∏–µ —Å–¥–µ–ª–∫–∏ (Closing)`,
              order: 2,
            },
            {
              title: '–û—Å–Ω–æ–≤—ã —Ä–∞–±–æ—Ç—ã —Å –æ–±—ä–µ–∫—Ç–∞–º–∏ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏',
              content: `–†–∞–±–æ—Ç–∞ —Å –æ–±—ä–µ–∫—Ç–∞–º–∏ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ —Ç—Ä–µ–±—É–µ—Ç –≥–ª—É–±–æ–∫–æ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è —Ä—ã–Ω–∫–∞. –¢–∏–ø—ã –æ–±—ä–µ–∫—Ç–æ–≤ –≤–∫–ª—é—á–∞—é—Ç –∞–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—ã, –≤–∏–ª–ª—ã, –∫–æ–º–º–µ—Ä—á–µ—Å–∫—É—é –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å –∏ –∑–µ–º–µ–ª—å–Ω—ã–µ —É—á–∞—Å—Ç–∫–∏.`,
              order: 3,
            },
            {
              title: '–ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è —Å –∫–ª–∏–µ–Ω—Ç–æ–º',
              content: `–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è - –æ—Å–Ω–æ–≤–∞ —É—Å–ø–µ—à–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Ä–∏—ç–ª—Ç–æ—Ä–∞. –í–∞–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–æ–≤–µ—Ä–∏–µ —Å –ø–µ—Ä–≤—ã—Ö —Å–µ–∫—É–Ω–¥ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ –∏ –∞–∫—Ç–∏–≤–Ω–æ —Å–ª—É—à–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–∞.`,
              order: 4,
            },
            {
              title: '–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞, –æ—Ç—á—ë—Ç–Ω–æ—Å—Ç—å –∏ —Ä–∞–±–æ—Ç–∞ –≤ CRM',
              content: `–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞ –∏ —Å–∏—Å—Ç–µ–º–Ω–æ—Å—Ç—å - –∑–∞–ª–æ–≥ —É—Å–ø–µ—Ö–∞ –≤ —Ä–∞–±–æ—Ç–µ —Ä–∏—ç–ª—Ç–æ—Ä–∞. –í–∞–∂–Ω–æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –¥–µ–Ω—å, —Ä–µ–≥—É–ª—è—Ä–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏ –∏ –≤–µ—Å—Ç–∏ –æ—Ç—á—ë—Ç–Ω–æ—Å—Ç—å.`,
              order: 5,
            },
          ],
        },
        quiz: {
          create: {
            title: '–ò—Ç–æ–≥–æ–≤—ã–π —Ç–µ—Å—Ç –ø–æ –æ—Å–Ω–æ–≤–∞–º —Ä–∞–±–æ—Ç—ã —Ä–∏—ç–ª—Ç–æ—Ä–∞',
            description: '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–≤–æ–∏ –∑–Ω–∞–Ω–∏—è, –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –≤ —Ö–æ–¥–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –∫—É—Ä—Å–∞',
            questions: {
              create: [
                {
                  text: '–ö–∞–∫–∞—è –∏–∑ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω—ã—Ö –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–µ–π –ù–ï –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ –æ—Å–Ω–æ–≤–Ω—ã–º –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç—è–º —Ä–∏—ç–ª—Ç–æ—Ä–∞?',
                  options: JSON.stringify([
                    '–ü–æ–∏—Å–∫ –∏ –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤',
                    '–ö–æ–Ω—Å—É–ª—å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –≤–æ–ø—Ä–æ—Å–∞–º –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏',
                    '–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ –æ–±—ä–µ–∫—Ç–æ–≤',
                    '–ü—Ä–æ–≤–µ–¥–µ–Ω–∏–µ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã—Ö —Ä–∞–±–æ—Ç',
                  ]),
                  correctOptionIndex: 3,
                  weight: 10,
                },
                {
                  text: '–ö–∞–∫–æ–π —ç—Ç–∞–ø –≤–æ—Ä–æ–Ω–∫–∏ –ø—Ä–æ–¥–∞–∂ —Å–ª–µ–¥—É–µ—Ç –ø–æ—Å–ª–µ –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ª–∏–¥–∞?',
                  options: JSON.stringify([
                    '–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ª–∏–¥–æ–≤',
                    '–ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è –æ–±—ä–µ–∫—Ç–æ–≤',
                    '–ó–∞–∫—Ä—ã—Ç–∏–µ —Å–¥–µ–ª–∫–∏',
                    '–ü–µ—Ä–µ–≥–æ–≤–æ—Ä—ã',
                  ]),
                  correctOptionIndex: 1,
                  weight: 10,
                },
                {
                  text: '–ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç —Ç–µ—Ö–Ω–∏–∫–∞ SPIN –≤ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏ —Å –∫–ª–∏–µ–Ω—Ç–æ–º?',
                  options: JSON.stringify([
                    '–°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–¥–∞–∂ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏',
                    '–ú–µ—Ç–æ–¥ —É—Ç–æ—á–Ω–µ–Ω–∏—è –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–µ–π —á–µ—Ä–µ–∑ –≤–æ–ø—Ä–æ—Å—ã',
                    '–°–ø–æ—Å–æ–± –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏ –æ–±—ä–µ–∫—Ç–æ–≤',
                    '–¢–µ—Ö–Ω–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å –≤–æ–∑—Ä–∞–∂–µ–Ω–∏—è–º–∏',
                  ]),
                  correctOptionIndex: 1,
                  weight: 10,
                },
                {
                  text: '–ö–∞–∫–æ–π —Ç–∏–ø –æ–±—ä–µ–∫—Ç–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ –æ–±—ã—á–Ω–æ —Ç—Ä–µ–±—É–µ—Ç –æ—Å–æ–±–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞ –∫ –∫–ª–∏–µ–Ω—Ç–∞–º?',
                  options: JSON.stringify([
                    '–ê–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—ã',
                    '–í–∏–ª–ª—ã',
                    '–ö–æ–º–º–µ—Ä—á–µ—Å–∫–∞—è –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å',
                    '–í—Å–µ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω—ã–µ',
                  ]),
                  correctOptionIndex: 1,
                  weight: 10,
                },
                {
                  text: '–ß—Ç–æ —è–≤–ª—è–µ—Ç—Å—è –æ—Å–Ω–æ–≤–æ–π —É—Å–ø–µ—à–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Ä–∏—ç–ª—Ç–æ—Ä–∞?',
                  options: JSON.stringify([
                    '–¢–æ–ª—å–∫–æ –∑–Ω–∞–Ω–∏–µ —Ä—ã–Ω–∫–∞',
                    '–¢–æ–ª—å–∫–æ –∫–æ–º–º—É–Ω–∏–∫–∞—Ç–∏–≤–Ω—ã–µ –Ω–∞–≤—ã–∫–∏',
                    '–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞, —Å–∏—Å—Ç–µ–º–Ω–æ—Å—Ç—å –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ –Ω–∞–≤—ã–∫–∏',
                    '–¢–æ–ª—å–∫–æ –Ω–∞–ª–∏—á–∏–µ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π –±–∞–∑—ã',
                  ]),
                  correctOptionIndex: 2,
                  weight: 10,
                },
                {
                  text: '–ö–∞–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –ù–ï –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ –±–∞–∑–æ–≤–æ–π —ç—Ç–∏–∫–µ —Ä–∏—ç–ª—Ç–æ—Ä–∞?',
                  options: JSON.stringify([
                    '–ß–µ—Å—Ç–Ω–æ—Å—Ç—å –∏ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å',
                    '–°–æ–±–ª—é–¥–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏',
                    '–ú–∞–Ω–∏–ø—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞–º–∏',
                    '–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ –æ—Ç–Ω–æ—à–µ–Ω–∏–µ –∫ –∫–æ–ª–ª–µ–≥–∞–º',
                  ]),
                  correctOptionIndex: 2,
                  weight: 10,
                },
                {
                  text: '–ß—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è —ç—Ç–∞–ø "–ü–µ—Ä–µ–≥–æ–≤–æ—Ä—ã" –≤ –≤–æ—Ä–æ–Ω–∫–µ –ø—Ä–æ–¥–∞–∂?',
                  options: JSON.stringify([
                    '–¢–æ–ª—å–∫–æ –æ–±—Å—É–∂–¥–µ–Ω–∏–µ —Ü–µ–Ω—ã',
                    '–û–±—Å—É–∂–¥–µ–Ω–∏–µ —É—Å–ª–æ–≤–∏–π —Å–¥–µ–ª–∫–∏, —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ —Ü–µ–Ω—ã –∏ —Å—Ä–æ–∫–æ–≤, —Ä–∞–±–æ—Ç–∞ —Å –≤–æ–∑—Ä–∞–∂–µ–Ω–∏—è–º–∏',
                    '–¢–æ–ª—å–∫–æ –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤',
                    '–¢–æ–ª—å–∫–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤',
                  ]),
                  correctOptionIndex: 1,
                  weight: 10,
                },
                {
                  text: '–ß—Ç–æ –≤–∞–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –æ–±—ä–µ–∫—Ç–∞–º–∏ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏?',
                  options: JSON.stringify([
                    '–¢–æ–ª—å–∫–æ —Ü–µ–Ω—É –æ–±—ä–µ–∫—Ç–∞',
                    '–°–ø–µ—Ü–∏—Ñ–∏–∫—É –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –æ–±—ä–µ–∫—Ç–∞ –∏ —É–º–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–µ–∑–µ–Ω—Ç–æ–≤–∞—Ç—å –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞',
                    '–¢–æ–ª—å–∫–æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ',
                    '–¢–æ–ª—å–∫–æ –ø–ª–æ—â–∞–¥—å –æ–±—ä–µ–∫—Ç–∞',
                  ]),
                  correctOptionIndex: 1,
                  weight: 10,
                },
                {
                  text: '–ß—Ç–æ –ø–æ–∫—É–ø–∞–µ—Ç –∫–ª–∏–µ–Ω—Ç –ø—Ä–∏ –ø—Ä–∏–æ–±—Ä–µ—Ç–µ–Ω–∏–∏ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏?',
                  options: JSON.stringify([
                    '–¢–æ–ª—å–∫–æ –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ –º–µ—Ç—Ä—ã',
                    '–†–µ—à–µ–Ω–∏–µ —Å–≤–æ–µ–π –∑–∞–¥–∞—á–∏ (–Ω–æ–≤—ã–π –¥–æ–º, –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—è, —Å—Ç–∞—Ç—É—Å –∏ —Ç.–¥.)',
                    '–¢–æ–ª—å–∫–æ –¥–æ–∫—É–º–µ–Ω—Ç—ã',
                    '–¢–æ–ª—å–∫–æ –æ–±—ä–µ–∫—Ç',
                  ]),
                  correctOptionIndex: 1,
                  weight: 10,
                },
                {
                  text: '–ö–∞–∫–∏–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –¥–∞—ë—Ç —Ä–∞–±–æ—Ç–∞ –≤ CRM?',
                  options: JSON.stringify([
                    '–¢–æ–ª—å–∫–æ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö',
                    '–í–µ–¥–µ–Ω–∏–µ –±–∞–∑—ã, –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏, –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –∑–∞–¥–∞—á, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞',
                    '–¢–æ–ª—å–∫–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è',
                    '–¢–æ–ª—å–∫–æ –æ—Ç—á—ë—Ç—ã',
                  ]),
                  correctOptionIndex: 1,
                  weight: 10,
                },
              ],
            },
          },
        },
      },
    });

    await prisma.$disconnect();

    return {
      success: true,
      message: 'Database seeded successfully',
      users: {
        student: student.username,
        hr: hr.username,
      },
      course: course.title,
    };
  } catch (error: any) {
    console.error('Seed error:', error);
    await prisma.$disconnect();
    throw error;
  }
}

export async function GET(request: NextRequest) {
  try {
    const searchParams = request.nextUrl.searchParams;
    const token = searchParams.get('token');
    const expectedToken = process.env.SEED_TOKEN || 'seed-me-please';

    if (token !== expectedToken) {
      return NextResponse.json(
        { error: 'Unauthorized. Provide ?token=YOUR_SECRET_TOKEN' },
        { status: 401 }
      );
    }

    const result = await seedDatabase();
    return NextResponse.json(result);
  } catch (error: any) {
    return NextResponse.json(
      {
        error: 'Failed to seed database',
        details: error.message,
      },
      { status: 500 }
    );
  }
}

export async function POST(request: NextRequest) {
  try {
    const searchParams = request.nextUrl.searchParams;
    const token = searchParams.get('token');
    const expectedToken = process.env.SEED_TOKEN || 'seed-me-please';

    if (token !== expectedToken) {
      return NextResponse.json(
        { error: 'Unauthorized. Provide ?token=YOUR_SECRET_TOKEN' },
        { status: 401 }
      );
    }

    const result = await seedDatabase();
    return NextResponse.json(result);
  } catch (error: any) {
    return NextResponse.json(
      {
        error: 'Failed to seed database',
        details: error.message,
      },
      { status: 500 }
    );
  }
}

